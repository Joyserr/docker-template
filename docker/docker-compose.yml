version: '3.8'

services:
  ros-dev:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      args:
        ROS_DISTRO: ${ROS_DISTRO}
        USER_NAME: ${USER_NAME}
        USER_UID: ${USER_UID}
        USER_GID: ${USER_GID}
    image: ${IMAGE_NAME}:${IMAGE_TAG}
    container_name: ${CONTAINER_NAME}
    network_mode: host
    privileged: true
    stdin_open: true
    tty: true
    environment:
      - DISPLAY=${DISPLAY}
      - QT_X11_NO_MITSHM=1
    volumes:
      # 挂载工作空间
      - ${WORKSPACE_DIR}:/home/${USER_NAME}/catkin_ws
      # 挂载X11 socket用于GUI显示
      - /tmp/.X11-unix:/tmp/.X11-unix
      # 可选: 挂载主机的.bashrc（如需要）
      # - ~/.bashrc:/home/${USER_NAME}/.bashrc_host:ro
    # 保持容器运行
    command: tail -f /dev/null
    # 可选: 资源限制
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '4'
    #       memory: 8G
    #     reservations:
    #       cpus: '2'
    #       memory: 4G
